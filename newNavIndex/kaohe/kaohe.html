
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>京能集团实时技术监督生产管理系统</title>

    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="js/tree_themes/SimpleTree.css"/>
    <link rel="stylesheet" href="../css/bootstrap-datetimepicker.min.css">
    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <link type="text/css" rel="stylesheet" href="css/news.css"/>
<body>
<div class="wu_top">

    <div class="fengge"></div>
</div>


<div class="wu_left">
    <div class="st_tree">
        <ul>
            <li><a href="#">京能集团</a></li>

            <ul show="true">
                <li title="c21834b4-1cb0-490f-a2a8-deeaf7f7e065"><a href="#" title="岱海发电">岱海发电</a></li>
                <li title="472212af-1977-462b-a74a-a1f36ed6562d"><a href="#" title="宁东发电">宁东发电</a></li>
            </ul>

    </div>


</div>


<div class="wu_main" style="border: 1px solid #ccc;    margin-top: 21px;">
    <div class="wu_top0 select" style="">
        <form class="form-inline">
            <div class="left form-group" style="margin-left:30px;">筛选条件</div>
            <div class="form-group ">
                <label class="w60 control-label left" for="org_id">单位</label>
                <select name="choose" class="form-control col-sm-1" id="org_id">
                    <option value="" ></option>
                    <option value="c21834b4-1cb0-490f-a2a8-deeaf7f7e065" >岱海电厂</option>

                    <option value="472212af-1977-462b-a74a-a1f36ed6562d">宁东电厂</option>
                    <option value="a61365e2-969d-4352-b3f8-805027ab9f1d">京能集团</option>
                </select>
            </div>

            <div class="form-group">
                <label for="startTime" class=" control-label left">考核时间</label>
                <!--<input class="form-control col-sm-1" type="text" id="startTime" >-->


                <div class="input-group date form_datetime col-sm-2" data-link-field="dtp_input1" style="position: relative;top: -3px;">
                    <input class="form-control col-sm-12" size="16" type="text" value="" readonly="" style="width:105px" id="startTime">
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>

                <input type="hidden" id="dtp_input1" value=""><br>
            </div>
            <div class="form-group">
                <label for="endTime" class=" control-label left" style="margin-left:0;">至</label>
                <!-- <input class="form-control col-sm-1" type="text" id="endTime" >-->
                <div class="input-group date form_datetime col-sm-2" data-link-field="dtp_input1" style="position: relative;top: -3px;">
                    <input class="form-control col-sm-12" size="16" type="text" value="" id="endTime" readonly="" style="width:105px">
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>

            </div>
            <div class="form-group">
                <label for="status" class=" control-label left">考核类型</label>
                <select name="choose" class="form-control col-sm-1" id="type">
                    <option value="0" selected>数据有效性</option>
                    <option value="1">参数超限</option>
                    <option value="1">故障</option>
                    <option value="2">定期工作未完成</option>
                    <option value="1">系统维护</option> 
                </select>
            </div>
            <div class="form-group">
                <label for="status" class=" control-label left">是否考核</label>
                <select name="choose" class="form-control col-sm-1" id="status">
                    <option value="1">是</option>
                    <option value="0">否</option>
                </select>
            </div>



            <div class="form-group" id="query" style="margin-left:22px;">
                <button class ="form-control col-sm-1 btn btn-primary" type="button" id="submit" style="position: relative;top: -2px;" id='query'>查询</button>
            </div>
        </form>


    </div>
    <div style="clear:both;"></div>

    <div class="wu_main1">
        <p id="lh_name">考核统计</p>
        <table class="wu_tab1">
            <thead>
            <tr>
                <td>本年考核次数</td>
                <td>本年考核金额(元)</td>
                <!--<td>已申诉考核</td>-->
                <td>本月考核次数</td>
                <td>本月考核金额(元)</td>
            </tr>

            </thead>
            <tbody id="zonglan">
            <tr>
                <td>5</td>
                <td>3</td>
             <!--   <td>1</td>-->
                <td>2</td>
                <td>1</td>
            </tr>
            </tbody>
        </table>
        <div class="select" style="">
            <form class="form-inline">

                    <button class="form-control col-sm-1 btn btn-default" type="button" id="submit" style="margin: 3px 5px 0 10px ">手动添加</button>


                    <button class="form-control col-sm-1 btn btn-default" type="button" id="submit" style="margin: 3px 5px 0 ">保存</button>


                 <!--   <button class="form-control col-sm-1 btn btn-default" type="button" id="submit" style="margin: 3px 5px 0 ">删除</button>-->


                    <button class="form-control col-sm-1 btn btn-default" type="button" id="submit" style="margin: 3px 5px 0 ">申诉</button>


                    <button class="form-control col-sm-1 btn btn-default" type="button" id="submit" style="margin: 3px 5px 0 ">申诉历史查询</button>

            </form>


        </div>
        <table class="wu_tab1 level4">

            <thead>
                <tr>
                    <td>序号</td>
                    <td>考核项目</td>
                    <td>考核时间</td>
                    <td>考核金额(元)</td>
                    <td>被考核单位</td>
                    <td>考核类型</td>
                    <td>是否考核</td>
                </tr>
            </thead>
            <tbody id="detail">
                <tr>
                    <td><input type="checkbox" class="tdCheck">1</td>
                    <td>震动集团级报警</td>
                    <td>2016.3.17</td>
                    <td>200</td>
                    <td>宁东电厂</td>
                    <td>自动</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td><input type="checkbox" class="tdCheck">2</td>
                    <td>数据中断</td>
                    <td>2016.3.17</td>
                    <td>200</td>
                    <td>岱海电厂</td>
                    <td>京能集团</td>
                    <td>是</td>
                </tr>
            </tbody>

        </table>
        

        <div class="fengge"></div>
        <div id="Pagination" class="pagination" style="float:right"><!-- 这里显示分页 --></div>
    </div>

    <div class="fengge"></div>
</div>
<!--<script type="text/javascript" src="js/jquery.js"></script>-->
<!--<script type="text/javascript" src="js/echarts2.js"></script>-->

<script type="text/javascript" src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/bootstrap-datetimepicker.min.js"></script>
<!--<script type="text/javascript" src="js/wj.js?v3"></script>-->
<script type="text/javascript" src="js/SimpleTree.js"></script>
<script type="text/javascript" src="js/jquery.pagination.js"></script>

<script type="text/javascript" src="js/Sweefty.js"></script>
<script type="text/javascript" src="js/moaModal.minified.js"></script>
<script type="text/javascript">
    window.onload = function () {      
        if (!window.location.origin) {
            window.location.origin = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
        }
        var ctx = window.location.origin;
        if(localStorage.getItem("orgid_baobiao")){
            var org_id_orgin = localStorage.getItem("orgid_baobiao");
        }else{
            alert("请返回到首页")
        }

        var qureyflag = true;

        $("#query").click(function(){
            query(1);
            function query(pageNum){
                var org_id    = $("#org_id").val();
                var startTime = $("#org_id").val();
                var endTime   = $("#org_id").val();
                var type      = $("#type").val();
                var status    = $("#").val(); 

               var url= ctx+"/jsjd/getKaoheAction.do?method=getKaoheShow&org_id="+org_id;
                $.ajax({
                    url:url,
                    type:"post",
                    dataType:"json",
                    data:{
                        pageSize:5,
                        pageNum:pageNum,
                        startTime:startTime,
                        endTime:endTime,
                        type:type,
                        key:status
                    },
                    success:function(data){
                        var page = Math.ceil(data.total/5)
                        $("#detail").html(prepare(data.pagedata));

                        if(qureyflag){
                            initPagination(page);//分页加载
                        }
                        qureyflag=false;   
                    }
                })

            }
            var initPagination = function(page) {
                var num_entries = page;
                // 创建分页
                $("#Pagination").pagination(num_entries, {
                    num_edge_entries: 1, //边缘页数
                    num_display_entries: 4, //主体页数
                    callback: pageselectCallback1,
                    items_per_page: 1, //每页显示1项
                    prev_text: "前一页",
                    next_text: "后一页"
                });
            };

      
            function pageselectCallback1(page_index, jq){
                query(page_index + 1);
                return false;
            }

        })
       
        
        
      
        kaohe_zonglan(org_id_orgin);
        kaohe_detail(org_id_orgin,1);
        function kaohe_zonglan(org_id){
            var url= ctx+"/jsjd/getKaoheAction.do?method=getTongJi&org_id="+org_id;
            $.ajax({
                url:url,
                dataType:"json",
                success:function(data){
                    var d = data;
                    var arr=[d.monthnum,d.yearAmount,d.monthnum,d.monthAmount];
                    $("#zonglan td").each(function(i){
                        $(this).html(arr[i]);
                    })
                    

                }
            })
        };
        var initPagination = function(page) {
            var num_entries = page;
            // 创建分页
            $("#Pagination").pagination(num_entries, {
                num_edge_entries: 1, //边缘页数
                num_display_entries: 4, //主体页数
                callback: pageselectCallback,
                items_per_page: 1, //每页显示1项
                prev_text: "前一页",
                next_text: "后一页"
            });
        };

      
        function pageselectCallback(page_index, jq){
            kaohe_detail(org_id_orgin,page_index + 1);
            return false;
        }
      
        var flag = true;
        function kaohe_detail(org_id,pageNum){

            var url= ctx+"/jsjd/getKaoheAction.do?method=getKaoheShow&org_id="+org_id;
            $.ajax({
                url:url,
                type:"post",
                dataType:"json",
                data:{
                    pageSize:5,
                    pageNum:pageNum
                },
                success:function(data){
                    var page = Math.ceil(data.total/5)
                    $("#detail").html(prepare(data.pagedata));

                    if(flag){
                        initPagination(page);//分页加载
                    }
                    flag=false;   
                }
            })

        }
        function prepare(data){
            var htmlArray = [];
            for(var i= 0;i<data.length;i++){

                var d=data[i];
                var j = i+1;
                htmlArray.push("<tr><td><input type='checkbox' class='tdCheck'>"+j+"</td><td>"+d.pro+"</td><td>"+d.date+"</td><td>"+d.amount+"</td><td>"+d.orgName+"<td>"+d.mode+"</td><td>"+d.key+"</td></tr>");

            }
            //console.log(htmlArray.join(""));
            return htmlArray.join("");

        }

          














        $('.form_datetime').datetimepicker({
            weekStart: 1,
            todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 4,
            minView: 4,
            forceParse: 0,
            //format: "yyyy-mm"
            format: "yyyy"
        });
        $('.button').modal({
            target: '#modal',
            speed: 500,
            easing: 'easeInOutBounce',
            animation: 'top',
            position: '200px auto',
            overlayClose: true,
            on: 'click'
        });

       
        var stree = $(".st_tree");
        stree.SimpleTree({
            click: function (a) {
                org_id_orgin = $(a).parent().attr("title");

                kaohe_zonglan(org_id_orgin);
                kaohe_detail(org_id_orgin,1);

            }
        })

    }
    

</script>
</body>
</html>
